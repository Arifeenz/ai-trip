<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</title>
  <style>
    #loading {
      display: none;
      font-style: italic;
      color: gray;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-top: 3px solid #333;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <h2>‡∏≠‡∏¢‡∏≤‡∏Å‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h2>

  <form id="questionForm">
    <input
      type="text"
      id="question"
      name="question"
      placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"
      required
      style="width: 300px; padding: 8px;"
    />
    <br><br>
    <button type="submit">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</button>
  </form>

  <div id="loading"><span class="spinner"></span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

  <br>
  <label for="responseBox">üìå ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:</label><br>
  <textarea id="responseBox" rows="10" cols="80" readonly></textarea>

  <script>
    function cleanThaiText(text) {
      return text
        .replace(/([‡∏Å-‡∏Æ])\s+([‡πà-‡πã‡πá‡∏±‡∏¥‡∏µ‡∏∂‡∏∑‡∏∏‡∏π‡πç])/g, "$1$2") // ‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞ + ‡∏ß‡∏£‡∏£‡∏ì‡∏¢‡∏∏‡∏Å‡∏ï‡πå/‡∏™‡∏£‡∏∞
        .replace(/([‡πà-‡πã‡πá‡∏±‡∏¥‡∏µ‡∏∂‡∏∑‡∏∏‡∏π‡πç])\s+([‡∏Å-‡∏Æ])/g, "$1$2") // ‡∏ß‡∏£‡∏£‡∏ì‡∏¢‡∏∏‡∏Å‡∏ï‡πå/‡∏™‡∏£‡∏∞ + ‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞
        .replace(/([‡∏Å-‡∏Æ])\s+([‡∏Å-‡∏Æ])/g, "$1$2")         // ‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞ + ‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞
        .replace(/\s{2,}/g, " ")                        // ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡πÄ‡∏Å‡∏¥‡∏ô 1
        .trim();
    }

    document.getElementById("questionForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const questionInput = document.getElementById("question");
      const responseBox = document.getElementById("responseBox");
      const loading = document.getElementById("loading");

      const question = questionInput.value;
      const payload = { question };

      responseBox.value = "";
      loading.style.display = "block";
      console.log("üì§ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook:", payload);

      try {
        const response = await fetch("https://hook.eu2.make.com/f2mlk48tc85r15zo7b9nx8sv8eur17nl", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        });

        console.log("üì• ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ response:", response.status);

        if (!response.ok) {
          throw new Error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î HTTP ${response.status}`);
        }

        const rawText = await response.text();
        console.log("üì® ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Webhook:\n", rawText);

        let cleanText = rawText.replace(/<metadata>[\s\S]*?<\/metadata>/gi, "").trim();
        cleanText = cleanThaiText(cleanText);

        responseBox.value = cleanText || "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏î‡πâ";
      } catch (error) {
        console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        responseBox.value = "‚ùå ‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message;
      } finally {
        loading.style.display = "none";
      }
    });
  </script>
</body>
</html>
